<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VolFlow Options Breakout Screener</title>
    <!-- Base Styles -->
    <link rel="stylesheet" href="css/base.css">
    
    <!-- Layout & Navigation -->
    <link rel="stylesheet" href="css/header-navigation.css">
    
    <!-- Component Styles (matching JS managers) -->
    <link rel="stylesheet" href="css/trading-controls.css">
    <link rel="stylesheet" href="css/positions-manager.css">
    <link rel="stylesheet" href="css/strategy-manager.css">
    <link rel="stylesheet" href="css/risk-manager.css">
    <link rel="stylesheet" href="css/watchlist-manager.css">
    <link rel="stylesheet" href="css/settings-manager.css">
    <link rel="stylesheet" href="css/security-panel.css">
    
    <!-- UI Components -->
    <link rel="stylesheet" href="css/modals-notifications.css">
    
    <!-- External Libraries -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Include Header Template -->
        <div id="header-container"></div>

        <!-- Include Navigation Template -->
        <div id="navigation-container"></div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Include Positions Panel Template -->
            <div id="positions-container"></div>

            <!-- Include Strategy Dashboard Template -->
            <div id="strategy-container"></div>

            <!-- Include Risk Management Panel Template -->
            <div id="risk-container"></div>

            <!-- Include Watchlist Panel Template -->
            <div id="watchlist-container"></div>

            <!-- Include Security Panel Template -->
            <div id="security-container"></div>

            <!-- Include Settings Panel Template -->
            <div id="settings-container"></div>
        </main>

        <!-- Include Modals Template -->
        <div id="modals-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Template Loader Script -->
    <script>
        // Template loader function
        async function loadTemplate(templatePath, containerId) {
            try {
                const response = await fetch(templatePath);
                const html = await response.text();
                document.getElementById(containerId).innerHTML = html;
            } catch (error) {
                console.error(`Error loading template ${templatePath}:`, error);
            }
        }

        // Load all templates
        async function loadAllTemplates() {
            const templates = [
                { path: 'templates/header.html', container: 'header-container' },
                { path: 'templates/navigation.html', container: 'navigation-container' },
                { path: 'templates/positions-panel.html', container: 'positions-container' },
                { path: 'templates/strategy-dashboard.html', container: 'strategy-container' },
                { path: 'templates/risk-management-panel.html', container: 'risk-container' },
                { path: 'templates/watchlist-panel.html', container: 'watchlist-container' },
                { path: 'templates/security-panel.html', container: 'security-container' },
                { path: 'templates/settings-panel.html', container: 'settings-container' },
                { path: 'templates/modals.html', container: 'modals-container' }
            ];

            // Load all templates in parallel
            await Promise.all(templates.map(template => 
                loadTemplate(template.path, template.container)
            ));

            // Initialize the application after templates are loaded
            initializeApp();
        }

        // Initialize application
        function initializeApp() {
            // Load modular JavaScript files after templates are loaded
            const scripts = [
                'js/websocket-manager.js',
                'js/watchlist-manager.js',
                'js/positions-manager.js',
                'js/strategy-manager.js',
                'js/risk-manager.js',
                'js/settings-manager.js',
                'js/analytics-manager.js',
                'js/trading-controls.js',
                'js/api-manager.js',
                'js/app.js'
            ];

            // Load scripts sequentially to maintain dependencies
            loadScriptsSequentially(scripts);
        }

        // Load scripts sequentially
        function loadScriptsSequentially(scripts) {
            if (scripts.length === 0) return;

            const script = document.createElement('script');
            script.src = scripts[0];
            script.onload = () => {
                loadScriptsSequentially(scripts.slice(1));
            };
            script.onerror = (error) => {
                console.error(`Error loading script ${scripts[0]}:`, error);
                loadScriptsSequentially(scripts.slice(1)); // Continue loading other scripts
            };
            document.head.appendChild(script);
        }

        // Load templates when DOM is ready
        document.addEventListener('DOMContentLoaded', loadAllTemplates);
    </script>
</body>
</html>
